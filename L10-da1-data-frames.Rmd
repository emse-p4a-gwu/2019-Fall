---
title: "Data Analysis 1 - Data Frames"
output: html_document
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
rm(list=objects()) # start with a clean workspace
source("knitr_setup.R")
```

This is the first lesson in a sequence on data analysis in R. Before reading this lesson, check out the ["Prelude to Data Analysis"](dataAnalysisPrelude.html).

> ### Learning Objectives
>
> * Describe what a data frame is.
> * Create data frames.
> * Use indexing to subset and modify specific portions of data frames.
> * Load external data from a .csv file into a data frame.
> * Summarize the contents of a data frame.
>
> ### Suggested Readings
>
> * ["Introduction to Data frames in R"](https://www.datacamp.com/community/tutorials/intro-data-frame-r) Data Camp article, by Ryan Sheehy
> * [Chapter 10](https://r4ds.had.co.nz/tibbles.html) of "R for Data Science", by Garrett Grolemund and Hadley Wickham
> * [Chapters 5.8 - 5.11](https://rstudio-education.github.io/hopr/r-objects.html#data-frames) of "Hands-On Programming with R", by Garrett Grolemund

---

# The data frame

## What are data frames?

Data frames are the _de facto_ data structure for most tabular data in R. A data frame can be created by hand, but most commonly they are generated by reading in a data file (typically a `.csv` file).

A data frame is the representation of data in the format of a table where the
columns are vectors that all have the same length. Because columns are
vectors, each column must contain a single type of data (e.g., numeric, character, integer, logical). For example, here is a figure depicting a data frame comprising a numeric, a character, and a logical vector:

![](./images/data-frame.png)

## The `data.frame()` function

You can create a data frame using the `data.frame()` function. In a data frame, every column must have a name. While elements within a column must be of the same type, different columns can have different types. Here is an example using of members of the Beatles band:

```{r}
df <- data.frame(
    firstName   = c("John", "Paul", "Ringo", "George"),
    lastName    = c("Lennon", "McCartney", "Starr", "Harrison"),
    instrument  = c("guitar", "bass", "drums", "guitar"),
    yearOfBirth = c(1940, 1942, 1940, 1943),
    deceased    = c(TRUE, FALSE, FALSE, TRUE)
)
df
```

## The `cbind()` and `rbind()` functions

You can combine data frames using the `cbind()` and `rbind()` functions, which stand for "column bind" and "row bind":

```{r}
# Combine columns
df_names <- data.frame(
    firstName = c("John", "Paul", "Ringo", "George"),
    lastName  = c("Lennon", "McCartney", "Starr", "Harrison")
)
df_instruments <- data.frame(
    instrument = c("guitar", "bass", "drums", "guitar")
)
cbind(df_names, df_instruments)
```

```{r}
# Combine rows
df_members1 <- data.frame(
    firstName = c("John", "Paul"),
    lastName  = c("Lennon", "McCartney")
)
df_members2 <- data.frame(
    firstName = c("Ringo", "George"),
    lastName  = c("Starr", "Harrison")
)
rbind(df_members1, df_members2)
```

## Dimensions

You can get the dimensions of a data frame using the `ncol()`, `nrow()`, and `dim()` functions:

```{r}
nrow(df) # Returns the number of rows
ncol(df) # Returns the number of columns
dim(df) # Returns a vector of the number rows and columns (in that order)
```

## Row and column names

Data frames **must** have column names and unique row names. The `names()` function returns the column names, or you can also be more specific and use the `colnames()` and `rownames()` functions:

```{r}
names(df) # Returns a vector of the column names
colnames(df) # Also returns a vector of the column names
rownames(df) # Returns a vector of the row names
```

# Accessing elements

You can access elements in a data frame using brackets `[]` and indices inside the brackets. The general form is:

```
DF[ROWS, COLUMNS]
```

You can use integer indices, character indices, and logical indices.

## Using integer indices

To index with integers, specify the row numbers and column numbers as vectors.

```{r}
df[1, 2] # Select the element in row 1, column 2
df[c(1, 2), c(2, 3)] # Select the elements in rows 1 & 2 and columns 2 & 3
df[1:2, 2:3] # Same thing, but using the ":" operator
```

If you leave either the row or column index blank, it means "selects all":

```{r}
df[c(1, 2),] # Leaving the column index blank will select all columns
df[,c(1, 2)] # Leaving the row index blank will select all rows
```

You can also use negative integers to specify rows or columns to be excluded:

```{r}
df[-1, ] # Select all rows and except the first
```

## Using character indices

You can use the column names to select elements in a data frame. If you do not include a `,` to designate which rows to select, R will return all the rows for the selected columns:

```{r}
df[1:2, c('firstName', 'lastName')] # Select first two rows for the "firstName" and "lastName" columns
df[c('firstName', 'lastName')] # Select all rows for the "firstName" and "lastName" columns
```

## Using the `$` operator

You can pull out a specific column by name by using the `$` operator plus the column name. For example, the `instrument` column can be accessed using `df$instrument`:

```{r}
df$instrument
```

## Using logical indices

When using a logical vector for indexing, the position where the logical vector is `TRUE` is returned. This is helpful for filtering data frames based on conditions. For example, if you wanted to filter out the rows for which Beatles members were still alive, you could use the `which` function in combination with the `$` operator to select those rows:

```{r}
which(df$deceased == FALSE) # Vector of indices for which the condition is TRUE
df[which(df$deceased == FALSE),] # Using those indices to filter the data frame
```

## Modifying data frames

You can use any of the above methods for accessing elements in a data frame to also modify those elements using the assignment operator (`<-`). In addition to using brackets to modify specific elements, you can use the `$` operator to create new columns in a data frame:

```{r}
df$age <- 2019 - df$yearOfBirth
df
```

You can make a new column of all the same value by just providing one value:

```{r}
df$hometown <- 'Liverpool'
df
```

# Dealing with actual data

Now that we know what a data frame is, let's start working with actual data! We are going to use the `msleep` data set, which contains data on sleep times and weights of different mammals. The data are taken from [V. M. Savage and G. B. West. "A quantitative, theoretical framework for understanding mammalian sleep." _Proceedings of the National Academy of Sciences_, 104 (3):1051-1056, 2007.](https://www.pnas.org/content/104/3/1051.long).

The dataset is stored as a comma separated value (CSV) file. Each row holds information for a single animal, and the columns represent:

| Column Name      | Description                        |
|------------------|------------------------------------|
name               | Common name
genus              | The taxonomic genus of animal
vore               | Carnivore, omnivore or herbivore?
order              | The taxonomic order of animal
conservation       | The conservation status of the animal
sleep_total        | Total amount of sleep, in hours
sleep_rem          | REM sleep, in hours
sleep_cycle        | Length of sleep cycle, in hours
awake              | Amount of time spent awake, in hours
brainwt            | Brain weight in kilograms
bodywt             | Body weight in kilograms

## R Setup

Before we dig into the data, let's prepare our analysis environment by following these steps:

1) Create a new R Project called "data-analysis-tutorial" and save the folder somewhere on your computer (see the ["RStudio projects"](L1.2-getting-started.html#33_rstudio_projects.html) section from waaaaay back on week 1).
2) Create a new `.R` file (File > New File > R Script), and save it as "`data_frames.R`" inside your "data-analysis-tutorial" R Project folder. From here on, we'll type all code for this lesson inside this `data_frames.R` file.
3) Create another folder in your R Project folder called "data" - we'll put data in this folder real soon.

## Getting the data

Use the `download.file()` function to download the comma separated value (CSV) file of the `msleep` data. The first argument is a character string with the source URL to the data file ("https://github.com/emse6574-gwu/2019-Fall/raw/gh-pages/data/msleep.csv"). The second argument is the destination where you want to locally save the file on your computer.

```{r, eval=FALSE}
download.file(
    url = "https://github.com/emse6574-gwu/2019-Fall/raw/gh-pages/data/msleep.csv",
    destfile = file.path('data', 'msleep.csv')
)
```

**Note on making file paths**: Notice the use of the `file.path()` function to generate the path to the "data" folder on your computer. This function will automatically use the correct "`/`" symbols to create the file path. This is important because the specific file path syntax is different depending on your computer operating system (e.g. mac is "`/`" and windows is "`\`"). In the above example, the destination file path used was:

```{r}
file.path('data', 'msleep.csv')
```

## Loading the data

You are now ready to load the data! The Base R function for reading in a csv file is called `read.csv()`, but it has some quirky aspects in how it formats the data (in particular, character variables). So instead we are going to use an improved function, `read_csv()`, from the `readr` package.

First, install the readr package if you haven't already:

```{r, eval=FALSE}
install.packages("readr")
```

Now load the data:

```{r}
library(readr)
df <- read_csv(file.path('data', 'msleep.csv'))
```

R tells us that we've successfully read in some data and a quick summary of the data type for each column in the dataset.

## Previewing the data

You can view the entire dataset in a tabular format (similar to how Excel looks) by using the `View()` function, which opens up another tab to view the data. Note that you cannot modify the data this way - you can just look at it:

```{r, eval = FALSE}
View(surveys)
```

In addition to viewing the whole dataset with `View()`, you can quickly view summaries of the data frame with a few convenient functions. For example, you can look at the first 6 rows by using the `head()` function:

```{r}
head(df)
```

Similarly, you can view the _last_ 6 rows by using the `tail()` function:

```{r}
tail(df)
```

You can also view an overview summary of each column and it's data types by using the `str()` function:

```{r}
str(df)
```

Finally, you can view summary statistics for each column using the `summary()` function:

```{r}
summary(df)
```

In summary, here is a non-exhaustive list of functions to get a sense of the content/structure of a data frame:

* Size:
    * `dim(df)` - returns a vector with the number of rows in the first element, and the number of columns as the second element (the **dim**ensions of the object).
    * `nrow(df)` - returns the number of rows.
    * `ncol(df)` - returns the number of columns.

* Content:
    * `head(df)` - shows the first 6 rows.
    * `tail(df)` - shows the last 6 rows.

* Names:
    * `names(df)` - returns the column names (synonym of `colnames()` for `data.frame` objects).
    * `rownames(df)` - returns the row names.

* Summary:
    * `str(df)` - structure of the object and information about the class, length and content of  each column.
    * `summary(df)` - summary statistics for each column.

Note: most of these functions are "generic", they can be used on other types of
objects besides `data.frame`.

## Tibbles are data frames

You'll notice that in the above examples, R told us that the `df` object was a "`tibble`", not a "`data.frame`". What's that about? Well, [tibbles](https://r4ds.had.co.nz/tibbles.html) are another data structure that are an improved version of the Base R data frame, and when you use the `readr` library to read in data, it creates a tibble.

Under the hood, tibbles are essentially the same thing as data frames and are designed to behave the same way. In fact, if we use the `class()` function to see what R thinks `df` really is...

```{r}
class(df)
```

... it agrees that in addition to being a tibble, `df` is also a data frame! We can check this more directly using the `is.data.frame()` function:

```{r}
is.data.frame(df)
```

That being said, there are a few differences between tibbles and pure data frames:

1) In addition to displaying the data type of each column under its name (which data tables don't do), a tibble will only print the first few rows of data when you enter the object name. In contrast, data frames will try to print _the entire data frame_...which is super annoying.
2) Columns of class `character` are never converted into factors (don't worry about this for now...just know that keeping strings as a `character` class generally makes life easier).

For now, we can safely ignore these differences (there are a few others...we'll get to them eventually). For the most part, my impression has been that whenever tibbles and data frames differ, the behavior of tibble tends to be a bit more intuitive.

With this in mind, I'll often use the term "data frame" to refer to both tibbles and data frames, since they are essentially the same things.

---

# Now what?

Now that you've got some data into R and are up to speed with what a data frame / tibble is, you may be asking, "so what now?" Well, over the next two lessons we will learn more about how to manipulate data frames and explore the underlying information with visualizations.

But just to give you an idea of where we're going, here are a few pieces of information from the `msleep` dataset:

1) It appears that mammalian brain and body weight are logarithmically correlated - cool!

```{r fig.height=4, fig.width=6, message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(msleep, aes(x=brainwt, y=bodywt)) +
    geom_point(alpha=0.6) +
    stat_smooth(method='lm', col='red', se=F, size=0.7) +
    scale_x_log10() +
    scale_y_log10() +
    labs(x='log(brain weight) in g', y='log(body weight) in kg') +
    theme_minimal()
```

2) It appears there may also be a negative, logarithmic relationship (albeit weaker) between the size of mammalian brains and how much they sleep - cool!

```{r fig.height=4, fig.width=6, message=FALSE, warning=FALSE}
ggplot(msleep, aes(x=brainwt, y=sleep_total)) +
    geom_point(alpha=0.6) +
    scale_x_log10() +
    scale_y_log10() +
    stat_smooth(method='lm', col='red', se=F, size=0.7) +
    labs(x='log(brain weight) in g', y='log(total sleep time) in hours') +
    theme_minimal()
```

3) Wow, there's a lot of variation in how much different mammals sleep - cool!

```{r fig.height=4, fig.width=6, message=FALSE, warning=FALSE}
ggplot(msleep, aes(x=sleep_total)) +
    geom_histogram() +
    labs(x     = 'Total sleep time in hours',
         title = 'Histogram of total sleep time') +
    theme_minimal()
```

---

**Page sources**:

Some content on this page has been modified from other courses, including:

- [Data Analysis and Visualization in R for Ecologists](https://datacarpentry.org/R-ecology-lesson/), by François Michonneau & Auriel Fournier. Zenodo: http://doi.org/10.5281/zenodo.3264888
